@model IEnumerable<KalustoLuetteloSovellus.Models.Tapahtuma>

@{
    var currentSort = Context.Request.Query["sortOrder"].ToString();

    string NextSort(string col)
    {
        return currentSort == col ? col + "_desc" :
        currentSort == col + "_desc" ? col :
        col;
    }

    string SortIcon(string col)
    {
        if (currentSort == col) return " ▲";
        if (currentSort == col + "_desc") return " ▼";
        return "";
    }

}



<table class="table table-hover table-bordered">
    <thead>
        <tr>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="Status">Status @SortIcon("Status")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="TapahtumaId">TapahtumaId @SortIcon("TapahtumaId")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="TuoteId">TuoteId @SortIcon("TuoteId")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="Tuote">Tuote @SortIcon("Tuote")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="IdNumero">Tunnistenro. @SortIcon("IdNumero")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="AloitusPvm">Luonti pvm @SortIcon("AloitusPvm")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="LopetusPvm">Palautus pvm @SortIcon("LopetusPvm")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="Kommentti">Kommentti @SortIcon("Kommentti")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="Käyttäjä">Käyttäjä @SortIcon("Käyttäjä")</a></th>
            <th style="vertical-align: top;"><a class="sort-link" href="#" data-sort="Toimipiste">Toimipiste @SortIcon("Toimipiste")</a></th>

            <th style="vertical-align: top;">Toiminnot</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {

                <tr data-status="@item.Status?.StatusNimi ?? " Tuntematon"">
                <td>@Html.DisplayFor(modelItem => item.Status.StatusNimi)</td>
                <td>@Html.DisplayFor(modelItem => item.TapahtumaId)</td>
                <td>@Html.DisplayFor(modelItem => item.Tuote.TuoteId)</td>
                <td>@Html.DisplayFor(modelItem => item.Tuote.Kuvaus)</td>
                <td>@Html.DisplayFor(modelItem => item.Tuote.IdNumero)</td>
                <td>@Html.DisplayFor(modelItem => item.AloitusPvm)</td>
                <td>@Html.DisplayFor(modelItem => item.LopetusPvm)</td>
                <td>@Html.DisplayFor(modelItem => item.Kommentti)</td>
                <td>@Html.DisplayFor(modelItem => item.Käyttäjä.Käyttäjätunnus)</td>
                @* <td class="ms-auto">@if (item.Status != null)@await Html.PartialAsync("_StatusPartial", item.Status)</td> *@
                <td>@Html.DisplayFor(model => item.Tuote.Toimipiste.KaupunkiJaToimipisteNimi)</td>
                <td class="d-flex gap-2">
                    @if (RoleHelper.IsUser(item.KäyttäjäId, Context) || RoleHelper.IsAdmin(Context))
                    {
                        <a class="btn btn-main" asp-controller="Tapahtumat" asp-action="Edit" asp-route-id="@item.TapahtumaId"><i class="fas fa-edit"></i></a>
                    }
                    else
                    {
                        <a class="btn btn-main disabled" asp-controller="Tapahtumat" asp-action="Edit" asp-route-id="@item.TapahtumaId"><i class="fas fa-edit"></i></a>
                    }
                    <a class="btn btn-main" asp-controller="Tapahtumat" asp-action="Details" asp-route-id="@item.TapahtumaId"><i class="fas fa-search"></i></a>
                    @if (RoleHelper.IsAdmin(Context))
                    {
                        <a class="btn btn-main" asp-controller="Tapahtumat" asp-action="Delete" asp-route-id="@item.TapahtumaId"><i class="fas fa-trash"></i></a>
                    }
                    else
                    {
                        <a class="btn btn-main disabled" asp-controller="Tapahtumat" asp-action="Delete" asp-route-id="@item.TapahtumaId"><i class="fas fa-trash"></i></a>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
@*
<script>
function SetColorCoding(checked) {
        console.log("SetColorCoding called, checked:", checked);
        const rows = document.querySelectorAll("table tbody tr");

        rows.forEach(row => {
            const status = row.dataset.status?.trim(); // Trim to remove leading/trailing spaces
            console.log("Row status:", status);

            if (checked) {
                let color = "white"; // Default color
                switch (status) {
                    case "Vapaa":
                        color = "#EEFFEC";
                        break;
                    case "Varattu":
                        color = "#FFEFEF";
                        break;
                    case "Huollossa":
                        color = "#FEFFEF";
                        break;
                    case "Kadonnut":
                        color = "#D6D4D4";
                        break;
                    case "Poistettu":
                        color = "#7F7F7F";
                        break;
                    default:
                        color = "white"; // Fallback for unknown statuses
                }
                row.style.backgroundColor = color;
            } else {
                row.style.backgroundColor = ""; // Reset to default
            }
        });
    }
</script>
*@